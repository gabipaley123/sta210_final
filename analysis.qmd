---
title: "Free Cash Flow and Returns"
author: "Gabriel Paley"
execute:
  echo: false
  warning: false
format: pdf
---

# Introduction

Free cash flow - or the amount of cash a company generates after accounting for the cash outflows needed to maintain or expand its asset base - is generally seen as a hallmark for a successful company, with value investor William Thorndike commenting "cash flow, not reported earnings, is what determines long-term value." Free cash flow (from here on donned FCF) allows management to reinvest in their business, reduce debt, pay dividends, or establish share buybacks, green flags for investors. In this report, I seek to establish whether there is an association between free cash flow growth and equity returns shortly following, over various time horizons. I also hope to explore whether this effect is strengthened by whether this growth comes from the top or bottom line (such as sales growth or cost cutting), whether the company has reported quality earnings (as opposed to manipulated figures), and whether the company has improved its liquidity position, or its ability to meet short-term and long-term obligations. I will also explore whether these effects vary across different industries. 

The data used is sourced from a combination of Bloomberg, Compustat Fundamentals Quarterly (via Wharton Research) and Yahoo Finance (processed in Python for previous projects). The data includes the following variables:

 - *(revenue_growth)*: Q/Q growth in sales/revenue, used to gauge top-line improvements (achieved by selling more product, 
    gaining customers, etc.) and calculated by using a standard percent change formula (left in decimal form).
 - *(fcf_growth)*: Q/Q growth in free cash flow
 - *(niq_growth)*: Q/Q growth in net income, used to gauge bottom-line improvements (improvement in net income holding revenue constant is achieved through efficiencies, diminishing labor/input costs, etc.)
 - *(current_ratio_change)*: Q/Q growth in current ratio, indicating the company's ability to meet its short term obligations
   
 - *(NEXT_1DAY/NEXT_5DAY/NEXT_10DAY)*: Returns achieved in the next 1, 5, and 10 days following rdq (quarter reporting date)
 
 - *(bTicker/cusip)*: Two methods of identifying companies
 - *(rdq)*: Reporting date for the quarter, or the reasonable date that investors received financial information which would influence subsequent returns
 - *(Industry)*: Company industry as per GICS standards

This data set consists of quarterly observations of companies, with each row representing a quarterly financial report made by a company. While this might initially seem like a potential violation of independence (repeated observation of one company), my analysis shows a low correlation between the next 10-day return after one quarter is reported and the return from the previous quarter. This low correlation indicates that, functionally, each quarter we are effectively analyzing information about an entirely different company, which has made independent decisions from the previous quarter. This makes sense — if this principle did not hold, simply investing in companies that had previously performed well would be a straightforward and successful strategy.

```{r}
library(dplyr)
library(tidyverse)
library(tidymodels)

fcf_data <- read.csv("fcf_returns_quarterly_clean.csv")

#Fixed data anomalies from csv file
fcf_data_filtered <- fcf_data |>
  mutate(fcf_growth = as.double(fcf_growth),
         revenue_growth = as.double(revenue_growth),
         niq_growth = as.double(niq_growth),
         earnings_quality = as.double(earnings_quality))

```

# Hypotheses

I expect that free cash flow growth will correspond with higher returns, particularly in the short term. Growth driven by revenue—indicative of strategic expansion—is likely to have a more substantial impact on returns than that driven by net income increases, when FCF growth is held steady. Furthermore, companies enhancing their liquidity and maintaining high earnings quality—evidenced by strong cash flow relative to net income—are also anticipated to yield better returns, given these traits reflect prudent management and sound financial practices. Finally, I hypothesize that the beneficial effects of robust FCF are largely consistent across different industries. 

# Initial Observations and EDA

In my initial analysis, I explore the distribution of FCF growth, focusing on eliminating extreme values caused by zeros, minimal prior-period FCF, and accounting irregularities. By bounding my histogram by the 1st and 99th percentiles, the data reveals a tendency for companies to experience declines in FCF rather than gains. This observation aligns with expectations, as achieving growth in FCF typically reflects effective management, a quality less commonly observed than inefficiency.

```{r}
library(ggplot2)

# Histogram of Free Cash Flow Growth with Quantile-based Limits
ggplot(fcf_data_filtered, aes(x = fcf_growth)) +
  geom_histogram(bins = 30, fill = "blue", color = "black") +
  scale_x_continuous(limits = c(quantile(fcf_data_filtered$fcf_growth, 0.01, na.rm = TRUE), 
                                quantile(fcf_data_filtered$fcf_growth, 0.99, na.rm = TRUE))) +
  theme_minimal() +
  labs(title = "Distribution of Free Cash Flow Growth", x = "Free Cash Flow Growth", y = "Frequency")

```

I viewed the distribution of the other variables using histograms and coverage plots for NA values, but for the purpose of concision, I have included five number summaries for each of the dataset columns. 

```{r}
summary(fcf_data_filtered)
```
Clipping the top and bottom percentile values and removing NaN values caused by Compustat discrepancies/accounting filing issues result in reasonable and interpretable predictor variables. This is done before the models are computed in the methodology section. I note that this limits the interpretation to companies which did not have a previous FCF, revenue, niq, or current ratio of 0 or NA, which result in growth figures of - or + infinity. Given more time, I would construct a new metric which diminishes the impact of small base values leading to high growth rates. 

The distribution of returns is also somewhat expected. The data is normally distributed around 0 with strong outperformers and underperformers at the tails (more extreme and rare events lead to more volatility in stock price). 

```{r}
ggplot(fcf_data_filtered, aes(x = NEXT_10DAY)) +
  geom_histogram(bins = 30, fill = "blue", color = "black") +  # Adjust the number of bins as needed
  labs(title = "Histogram of Next 10 Day Returns",
       x = "IND_NEXT_10DAY Returns",
       y = "Frequency") +
  theme_minimal()
```
# Methodology and Assumptions

```{r echo = FALSE, warning = FALSE}
filtered_cleaned_fcf <- fcf_data_filtered |>
  mutate(across(c(fcf_growth, 
                  revenue_growth, niq_growth, 
                  current_ratio_change,
                  quick_ratio_change, earnings_quality),
                  ~ifelse(. < quantile(., 0.01, na.rm = TRUE),
                          quantile(., 0.01, na.rm = TRUE),
                   ifelse(. > quantile(., 0.99, na.rm = TRUE),
                           quantile(., 0.99, na.rm = TRUE), .))))

filtered_cleaned_fcf <- filter(filtered_cleaned_fcf, 
                               complete.cases(filtered_cleaned_fcf))
  
```

This study employs linear and multiple regression analyses to address the research questions concerning the relationship between free cash flow growth and short-term equity returns. The dependent variables in our models are the next-day (NEXT_1DAY), next five-day (NEXT_5DAY), and next ten-day (NEXT_10DAY) equity returns. Each model progressively incorporates additional explanatory variables and controls to isolate the effects of various financial metrics on these returns.

Base Model: Initially, a simple linear regression model was fitted with NEXT_1DAY, NEXT_5DAY, and NEXT_10DAY returns as dependent variables and free cash flow (FCF) growth as the independent variable. This model serves as a baseline to understand the unadjusted effect of FCF growth on equity returns.

Extended Models: To refine our understanding and control for additional financial performance indicators, several extended models were constructed:

- Top and Bottom Line Growth: FCF growth was examined while controlling for top-line (revenue growth) and bottom-line (net income growth) improvements. This model assesses whether the impact of FCF growth on returns remains significant when accounting for these broader financial growth metrics.
- Liquidity Improvement: Another model incorporated changes in the current ratio to evaluate how improvements in liquidity, alongside FCF growth, influence equity returns. This is predicated on the hypothesis that liquidity metrics may moderate the relationship between cash flow and market performance.
- Earnings Quality: FCF growth was also analyzed in conjunction with a measure of earnings quality, operationalized as the ratio of operating cash flow to net income. This model tests whether the quality of earnings affects the predictive power of FCF growth on subsequent stock returns.
- Industry Interaction: Finally, an interaction term between FCF growth and company industry was included to explore whether the effect of FCF growth varies across different sectors. This acknowledges the potential for industry-specific factors to influence how investors respond to cash flow information.

In order to assess the independence assumption necessary for a linear regression, I have performed a correlation analysis to investigate whether returns following a previous quarter's announcement are indicative of returns in the subsequent quarter. The analysis revealed minimal correlation for 1DAY, 5DAY, and 10DAY returns, suggesting that these returns are largely independent from one quarter to the next. 

```{r}
fcf_data_filtered <- fcf_data_filtered %>%
  arrange(bTicker, rdq) %>%
  group_by(bTicker) %>%
  mutate(
    PREV_1DAY_OBS = lag(NEXT_1DAY),
    PREV_5DAY_OBS = lag(NEXT_5DAY),
    PREV_10DAY_OBS = lag(NEXT_10DAY)
  ) %>%
  ungroup()

# Calculating correlation and testing independence
correlation_analysis <- fcf_data_filtered %>%
  summarise(
    Cor_1DAY = cor(NEXT_1DAY, PREV_1DAY_OBS, use = "complete.obs"),
    Cor_5DAY = cor(NEXT_5DAY, PREV_5DAY_OBS, use = "complete.obs"),
    Cor_10DAY = cor(NEXT_10DAY, PREV_10DAY_OBS, use = "complete.obs")
  )

# View the correlation coefficients
print(correlation_analysis)

model_base_resid <- augment(fcf_model_base)
```

Residual and quantile-quantile plots were utilized to evaluate the assumptions of linearity, constant variance, and normality in our base regression model of returns versus FCF growth. While the assumptions of linearity and constant variance are generally met, the normality assumption is somewhat violated, particularly at the tails of the distribution as evidenced in the Q/Q plot. This suggests that while linear regression is suitable, caution should be exercised regarding the prediction intervals due to potential deviations from normality.

```{r}
ggplot(data = model_base_resid, aes(x = .fitted, y = .resid)) +
          geom_point() +
          labs(x = "Fitted values", y = "Residuals",
          title = "Evidence of Linearity and Non-Constant Variance")
  
```
```{r}
ggplot(data = model_base_resid, aes(sample = .resid)) +
                  stat_qq() +
                  stat_qq_line() +
                  labs(x = "Theoretical quantiles", y = "Sample quantiles",
                  title = "Evidence of non-normality of residuals")
                  
```
While linearity and constant variance are satisfied (the residuals are distributed symmetrically along the horizontal axis with even spread along all fitted values), normality is violated to some degree, as the sample quantiles deviate from the theoretical quantiles at the tails of the Q/Q plot. Even given this violation, it seems reasonable to use a linear regression, with the caveat that the model may result in invalid prediction intervals as a result of the normality assumption being violated. As a note, the presence of vertical lines in the plot of constant variance, indicative of the clipping of predictor variables, is a notable artifact affecting the visual assessment of variance. It's important to acknowledge that this feature is consistent across all regression models utilized in this study, suggesting a systematic influence on our findings.

# Results

## Base Model

```{r}
fcf_model_base <- lm(filtered_cleaned_fcf$NEXT_10DAY ~ fcf_growth, data = filtered_cleaned_fcf)
```

```{r}
tidy(fcf_model_base)
```

## Model Adjusting For Top And Bottom Line
```{r}
fcf_model_top_bottom_line <- lm(filtered_cleaned_fcf$NEXT_10DAY ~ fcf_growth + filtered_cleaned_fcf$revenue_growth + filtered_cleaned_fcf$niq_growth, data = filtered_cleaned_fcf)
summary(fcf_model_top_bottom_line)
```

```{r}
fcf_model_addtl_factors <- lm(filtered_cleaned_fcf$NEXT_10DAY ~ fcf_growth + filtered_cleaned_fcf$revenue_growth + 
                                  filtered_cleaned_fcf$niq_growth + filtered_cleaned_fcf$current_ratio_change +
                                  filtered_cleaned_fcf$earnings_quality, data = filtered_cleaned_fcf)
summary(fcf_model_addtl_factors)
```
```{r}
fcf_model_ind_interaction_term <- lm(filtered_cleaned_fcf$NEXT_10DAY ~ revenue_growth, data = filtered_cleaned_fcf)
summary(fcf_model_ind_interaction_term)
```


