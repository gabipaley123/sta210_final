---
title: "Free Cash Flow and Returns"
author: "Gabriel Paley"
format: pdf
---

# Introduction

Free cash flow - or the amount of cash a company generates after accounting for the cash outflows needed to maintain or expand its asset base - is generally seen as a hallmark for a successful company, with value investor William Thorndike commenting "cash flow, not reported earnings, is what determines long-term value." Free cash flow (from here on donned FCF) allows management to reinvest in their business, reduce debt, pay dividends, or establish share buybacks, green flags for investors. In this report, I seek to establish whether there is an association between free cash flow growth and equity returns shortly following, over various time horizons. I also hope to explore whether this effect is strengthened by whether investors value this growth coming from the top or bottom line (such as sales growth or cost cutting), whether the company has reported quality earnings (as opposed to manipulated figures), and whether the company has improved its liquidity position, or its ability to meet short-term and long-term obligations.

The data used is sourced from a combination of Bloomberg, Compustat Fundamentals Quarterly (via Wharton Research) and Yahoo Finance (combined in Python for previous projects). The data includes the following variables:

 - *(revenue_growth)*: Q/Q growth in sales/revenue, used to gauge top-line improvements (achieved by selling more product, 
    gaining customers, etc.) and calculated by using a standard percent change formula (left in decimal form).
 - *(fcf_growth)*: Q/Q growth in free cash flow
 - *(niq_growth)*: Q/Q growth in net income, used to gauge bottom-line improvements (improvement in net income holding revenue constant is achieved through efficiencies, diminishing labor/input costs, etc.)
 - *(current_ratio_change)*: Q/Q growth in current ratio, indicating the company's ability to meet its short term obligations
 - *(quick_ratio_change)*: Q/Q growth in quick ratio, indicating the company's ability to meet its short term obligations but using
    only its most liquid assets (generally considered a stricter metric)
   
 - *(NEXT_1DAY/NEXT_5DAY/NEXT_10DAY)*: Returns achieved in the next 1, 5, and 10 days following rdq (quarter reporting date)
 
 - *(bTicker/cusip)*: Two methods of identifying companies
 - *(rdq)*: Reporting date for the quarter, or the reasonable date that investors received financial information which would influence subsequent returns
 - *(Industry)*: Company industry as per GICS standards

This data set consists of quarterly observations of companies, with each row representing a quarterly financial report made by a company. While this might initially seem like a potential violation of independence (repeated observation of one company), my analysis shows a low correlation between the next 10-day return after one quarter is reported and the return from the previous quarter. This low correlation indicates that, functionally, each quarter we are effectively analyzing information about an entirely different company, which has made independent decisions from the previous quarter. This makes sense â€” if this principle did not hold, simply investing in companies that had previously performed well would be a straightforward and successful strategy.

```{r}
library(dplyr)
library(tidyverse)
library(tidymodels)

fcf_data <- read.csv("fcf_returns_quarterly_clean.csv")

fcf_data_filtered <- fcf_data |>
  mutate(fcf_growth = as.double(fcf_growth),
         revenue_growth = as.double(revenue_growth),
         niq_growth = as.double(niq_growth),
         earnings_quality = as.double(earnings_quality))

```

# Hypotheses



In my prior experience with financial data, it is important to be disciplined about 
# Initial Observations and EDA

In my initial analysis, I explore the distribution of FCF growth, focusing on eliminating extreme values caused by zeros, minimal prior-period FCF, and accounting irregularities. By bounding my histogram by the 1st and 99th percentiles, the data reveals a tendency for companies to experience declines in FCF rather than gains. This observation aligns with expectations, as achieving growth in FCF typically reflects effective management, a quality less commonly observed than inefficiency.

```{r}
library(ggplot2)

# Histogram of Free Cash Flow Growth with Quantile-based Limits
ggplot(fcf_data_filtered, aes(x = fcf_growth)) +
  geom_histogram(bins = 30, fill = "blue", color = "black") +
  scale_x_continuous(limits = c(quantile(fcf_data_filtered$fcf_growth, 0.01, na.rm = TRUE), 
                                quantile(fcf_data_filtered$fcf_growth, 0.99, na.rm = TRUE))) +
  theme_minimal() +
  labs(title = "Distribution of Free Cash Flow Growth", x = "Free Cash Flow Growth", y = "Frequency")

```

I viewed the distribution of the other variables using histograms and coverage plots for NA values, but for the purpose of concision, I have included five number summaries for each of the dataset columns. 

```{r}
summary(fcf_data_filtered)
```
Clipping the top and bottom percentile values and removing NaN values caused by Compustat discrepancies/accounting filing issues result in reasonable and interpretable predictor variables. This is done before the models are computed in the methodology section.

The distribution of returns is also somewhat expected. The data is normally distributed around 0 with strong outperformers and underperformers at the tails (more extreme and rare events lead to more volatility in stock price). 

```{r}
ggplot(fcf_data_filtered, aes(x = NEXT_10DAY)) +
  geom_histogram(bins = 30, fill = "blue", color = "black") +  # Adjust the number of bins as needed
  labs(title = "Histogram of Next 10 Day Returns",
       x = "IND_NEXT_10DAY Returns",
       y = "Frequency") +
  theme_minimal()
```
# Methodology

```{r}
filtered_cleaned_fcf <- fcf_data_filtered |>
  mutate(across(c(fcf_growth, 
                  revenue_growth, niq_growth, 
                  current_ratio_change,
                  quick_ratio_change, earnings_quality),
                  ~ifelse(. < quantile(., 0.01, na.rm = TRUE),
                          quantile(., 0.01, na.rm = TRUE),
                   ifelse(. > quantile(., 0.99, na.rm = TRUE),
                           quantile(., 0.99, na.rm = TRUE), .))))

filtered_cleaned_fcf <- filter(filtered_cleaned_fcf, 
                               complete.cases(filtered_cleaned_fcf))

filtered_cleaned_fcf
  
```

```{r}
fcf_model_base <- lm(filtered_cleaned_fcf$NEXT_10DAY ~ fcf_growth, data = filtered_cleaned_fcf)
```

```{r}
tidy(fcf_model_base)
```
```{r}
fcf_model_top_bottom_line <- lm(filtered_cleaned_fcf$IND_NEXT_10DAY ~ fcf_growth + filtered_cleaned_fcf$revenue_growth + filtered_cleaned_fcf$niq_growth, data = filtered_cleaned_fcf)
summary(fcf_model_top_bottom_line)
```
```{r}
fcf_model_addtl_factors <- lm(filtered_cleaned_fcf$IND_NEXT_10DAY ~ fcf_growth + filtered_cleaned_fcf$revenue_growth + 
                                  filtered_cleaned_fcf$niq_growth + filtered_cleaned_fcf$current_ratio_change +
                                  filtered_cleaned_fcf$earnings_quality, data = filtered_cleaned_fcf)
summary(fcf_model_addtl_factors)
```
```{r}
fcf_model_ind_interaction_term <- lm(filtered_cleaned_fcf$IND_NEXT_10DAY ~ revenue_growth, data = filtered_cleaned_fcf)
summary(fcf_model_ind_interaction_term)
```
```{r}
library(ggplot2)

# Make sure to start with an empty data frame with the correct types
beta_over_time <- data.frame(
  Year = numeric(),
  Beta = numeric(),
  CI_lower = numeric(),
  CI_upper = numeric(),
  stringsAsFactors = FALSE # This prevents automatic conversion to factors
)

# Loop through each year, fit the model, and extract the coefficients and confidence intervals
for (year in unique_years) {
  data_subset <- filtered_cleaned_fcf[filtered_cleaned_fcf$year == year, ]
  model <- lm(IND_NEXT_10DAY ~ revenue_growth, data = data_subset)
  beta <- coef(model)["revenue_growth"]
  ci <- confint(model, "revenue_growth", level = 0.95)
  
  # Add the results to the data frame without conversion to character
  beta_over_time <- rbind(beta_over_time, data.frame(Year = as.numeric(year), Beta = as.numeric(beta), 
                                                     CI_lower = as.numeric(ci[1]), CI_upper = as.numeric(ci[2]), 
                                                     stringsAsFactors = FALSE))
}

# Now beta_over_time should have numeric values for 'Beta', 'CI_lower', and 'CI_upper'

ggplot(beta_over_time, aes(x = Year, y = Beta)) +
  geom_point() +
  geom_errorbar(aes(ymin = CI_lower, ymax = CI_upper), width = 0.2) +
  labs(title = "Beta Coefficients over Time",
       x = "Year",
       y = "Beta Coefficient") +
  scale_y_continuous(labels = scales::scientific) +  # Use scientific notation for y-axis labels
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
        axis.text.y = element_text(angle = 0)) # Make y-axis labels horizontal
```

